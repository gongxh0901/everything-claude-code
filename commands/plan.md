---
description: 重述需求，评估风险，并创建逐步实现计划。在接触任何代码之前等待用户确认。
---

# Plan 命令

此命令调用 **planner** 代理在编写任何代码之前创建全面的实现计划。

## 此命令的功能

1. **重述需求** - 明确需要构建什么
2. **识别风险** - 发现潜在问题和阻碍
3. **创建分步计划** - 将实现分解为阶段
4. **等待确认** - 必须在继续之前获得用户批准

## 何时使用

在以下情况下使用 `/plan`：
- 开始一个新功能
- 进行重大架构更改
- 进行复杂的重构工作
- 将影响多个文件/组件
- 需求不清楚或含糊不清

## 工作原理

planner 代理将：

1. **分析请求**并用清晰的术语重述需求
2. **分解为阶段**，包含具体的可操作步骤
3. **识别组件之间的依赖关系**
4. **评估风险**和潜在阻碍
5. **估计复杂度**（高/中/低）
6. **展示计划**并等待你的明确确认

## 使用示例

```
User: /plan I need to add real-time notifications when markets resolve

Agent (planner):
# 实现计划：实时市场解决通知

## 需求重述
- 当用户关注的市场解决时向他们发送通知
- 支持多个通知渠道（应用内、电子邮件、webhook）
- 确保通知可靠传递
- 包含市场结果和用户的头寸结果

## 实现阶段

### 阶段 1：数据库架构
- 添加 notifications 表，包含列：id、user_id、market_id、type、status、created_at
- 添加 user_notification_preferences 表用于渠道偏好设置
- 在 user_id 和 market_id 上创建索引以提高性能

### 阶段 2：通知服务
- 在 lib/notifications.ts 中创建通知服务
- 使用 BullMQ/Redis 实现通知队列
- 为失败的传递添加重试逻辑
- 创建通知模板

### 阶段 3：集成点
- 挂接到市场解决逻辑（当状态更改为 "resolved"）
- 查询市场中所有有头寸的用户
- 为每个用户排队通知

### 阶段 4：前端组件
- 在头部创建 NotificationBell 组件
- 添加 NotificationList 模态框
- 通过 Supabase 订阅实现实时更新
- 添加通知偏好设置页面

## 依赖项
- Redis（用于队列）
- 电子邮件服务（SendGrid/Resend）
- Supabase 实时订阅

## 风险
- 高：电子邮件可传递性（需要 SPF/DKIM）
- 中：每个市场有 1000+ 用户时的性能
- 中：如果市场频繁解决，可能会出现通知垃圾邮件
- 低：实时订阅开销

## 估计复杂度：中等
- 后端：4-6 小时
- 前端：3-4 小时
- 测试：2-3 小时
- 总计：9-13 小时

**等待确认**：继续执行此计划？（yes/no/modify）
```

## 重要说明

**关键**：planner 代理在你明确使用 "yes" 或 "proceed" 或类似的肯定回复确认计划之前，**不会**编写任何代码。

如果你想要更改，回复：
- "modify: [你的更改]"
- "different approach: [替代方案]"
- "skip phase 2 and do phase 3 first"

## 与其他命令集成

计划完成后：
- 使用 `/tdd` 通过测试驱动开发来实现
- 如果出现构建错误，使用 `/build-and-fix`
- 使用 `/code-review` 审查完成的实现

## 相关代理

此命令调用位于以下位置的 `planner` 代理：
`~/.claude/agents/planner.md`
